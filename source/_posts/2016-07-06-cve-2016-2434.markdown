---
layout: post
title: "CVE-2016-2434"
date: 2016-07-06 09:32:33 +0900
comments: true
categories: 
---

"The NVIDIA video driver in Android before 2016-05-01 on Nexus 9 devices allows attackers to gain privileges via a crafted application, aka internal bug 27251090."

```
	prctl(PR_SET_NAME, (unsigned long)NEW_PROC_NAME,0,0,0);
```

`prctl()` 라는 콜도 처음 알았고, 이걸로 process 이름을 바꿀 수 있는지도 처음 알았다. 나중에 task structure 를 뒤질때, marker 로서 활용하는 듯 하다.

`get_root()` 라는 함수를 콜하고 나서, `setresuid()` & `setresgid()` 를 호출.

그럼 `get_root()` 함수를 보자.

map_nvmap_handle() 을 호출하는데, 이 함수가 하는 일은.

`/dev/nvmap` 을 연다. GPU 메모리 관리 드라이버인듯. `drivers/video/tegra/nvmap/` 에 소스가 있다.

```
static int map_nvmap_handle(unsigned int *handle)
{

}
```

디바이스를 연다음에, `nvmap_create_handle` 이라는 구조체를 셋업한다.

```
struct nvmap_create_handle {
	union {
		__u32 id;
		__u32 size;
		__s32 fd;
	};
	__u32 handle;
};
```

`nvmap_arg.size = 0x10000;` 으로 세팅해서 `/dev/nvmap` 에 `ioctl(fd, NVMAP_IOC_CREATE, &nvmap_arg)` 을 한다.

이 ioctl() 의 리턴값이 `nvmap_arg.handle` 에 실리는 모양.
